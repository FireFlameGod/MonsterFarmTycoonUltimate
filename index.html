<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monster Farm Tycoon - Bel√©p√©s</title>
    <style>
        body {
            background-color: #2c3e50;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* --- 1. LOGIN K√âPERNY≈ê ST√çLUS --- */
        #login-screen {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            width: 85%;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        h1 { color: #f1c40f; margin-bottom: 0; }
        p { color: #bdc3c7; margin-top: 5px; }

        input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            box-sizing: border-box;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
        }

        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: 0.2s;
            font-weight: bold;
        }
        button:active { transform: scale(0.98); }
        
        .error { color: #e74c3c; font-weight: bold; display: none; }

        /* --- 2. J√ÅT√âK K√âPERNY≈ê (Alapb√≥l rejtve) --- */
        #game-screen {
            display: none; /* Ez rejti el indul√°skor! */
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* A fels≈ë men√ºsor (HUD) */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
        }

        .stats { font-size: 18px; font-weight: bold; }
        #money-display { color: #f1c40f; }

        #logout-btn {
            background: #c0392b;
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }

        /* Teszt gomb k√∂z√©pre */
        .center-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>Teszt Farm</h1>
        <p>L√©pj be a a fantasztikus vil√°gba!</p>
        
        <input type="text" id="username" placeholder="Felhaszn√°l√≥n√©v">
        <input type="password" id="password" placeholder="Jelsz√≥">
        
        <button onclick="loginOrRegister()">Bel√©p√©s / Start</button>
        <div id="error-msg" class="error">Hib√°s jelsz√≥!</div>
        <p style="font-size: 12px; opacity: 0.7;">Ha √∫j nevet √≠rsz, automatikusan regisztr√°lunk.</p>
    </div>

    <div id="game-screen">
        <div class="hud">
            <div class="stats">
                üë§ <span id="player-name">Player</span><br>
                üí∞ <span id="money-display">0</span> CC
            </div>
            <button id="logout-btn" onclick="logout()">Kil√©p√©s</button>
        </div>

        <div class="center-content">
            <h2>√údv a farmodon!</h2>
            <p>Ez itt a saj√°t ter√ºleted.</p>
            <button onclick="addMoney()" style="background: #e67e22;">+50 P√©nz (Klikk!)</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, update, increment, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- A TE SAJ√ÅT CONFIGOD (M√°r beillesztve) ---
        const firebaseConfig = {
            apiKey: "AIzaSyA-MauYrQl5WZ4TPv53vNxuUFnW3dEG0Z8",
            authDomain: "monsterfarmtycoonultimate.firebaseapp.com",
            databaseURL: "https://monsterfarmtycoonultimate-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "monsterfarmtycoonultimate",
            storageBucket: "monsterfarmtycoonultimate.firebasestorage.app",
            messagingSenderId: "621935486358",
            appId: "1:621935486358:web:ac7d20b0beb3933f64e9b7"
        };
        // ----------------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentPlayer = null;

        // --- 1. AUTOMATIKUS BEL√âP√âS (Ha van mentett jelsz√≥) ---
        window.onload = function() {
            const savedUser = localStorage.getItem('mf_user');
            const savedPass = localStorage.getItem('mf_pass');

            // Ha tal√°lunk mentett adatot, kit√∂ltj√ºk a mez≈ëket √©s megpr√≥b√°lunk bel√©pni
            if (savedUser && savedPass) {
                document.getElementById('username').value = savedUser;
                document.getElementById('password').value = savedPass;
                loginOrRegister(); 
            }
        };

        // --- 2. LOGIN / REGISZTR√ÅCI√ì LOGIKA ---
        window.loginOrRegister = function() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const errorDiv = document.getElementById('error-msg');

            if (user === "" || pass === "") {
                errorDiv.innerText = "K√©rlek t√∂lts ki minden mez≈ët!";
                errorDiv.style.display = "block";
                return;
            }

            const dbRef = ref(db);
            // Megn√©zz√ºk, l√©tezik-e m√°r a felhaszn√°l√≥
            get(child(dbRef, `users/${user}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    // --- L√âTEZIK: Jelsz√≥ ellen≈ërz√©s ---
                    const userData = snapshot.val();
                    if (userData.password === pass) {
                        startGame(user);
                    } else {
                        errorDiv.innerText = "Hib√°s jelsz√≥!";
                        errorDiv.style.display = "block";
                    }
                } else {
                    // --- NEM L√âTEZIK: √öj fi√≥k l√©trehoz√°sa ---
                    set(ref(db, 'users/' + user), {
                        username: user,
                        password: pass,
                        money: 100, // Kezd≈ë p√©nz
                        level: 1,
                        joined: Date.now()
                    }).then(() => {
                        startGame(user);
                    });
                }
            }).catch((error) => {
                console.error(error);
                errorDiv.innerText = "Hiba a kapcsol√≥d√°skor!";
                errorDiv.style.display = "block";
            });
        };

        // --- 3. J√ÅT√âK IND√çT√ÅSA ---
        function startGame(username) {
            currentPlayer = username;
            
            // Lementj√ºk a b√∂ng√©sz≈ëbe a bel√©p√©st
            localStorage.setItem('mf_user', username);
            localStorage.setItem('mf_pass', document.getElementById('password').value);

            // K√©perny≈ëcsere: Login elt≈±nik -> J√°t√©k megjelenik
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            
            // N√©v ki√≠r√°sa
            document.getElementById('player-name').innerText = username;

            // ADATOK FOLYAMATOS FIGYEL√âSE (Realtime)
            const moneyRef = ref(db, `users/${username}/money`);
            onValue(moneyRef, (snapshot) => {
                const money = snapshot.val();
                // Friss√≠tj√ºk a p√©nzt a k√©perny≈ën
                document.getElementById('money-display').innerText = money;
            });
        }

        // --- 4. P√âNZ N√ñVEL√âSE GOMB ---
        window.addMoney = function() {
            if(currentPlayer) {
                update(ref(db, `users/${currentPlayer}`), {
                    money: increment(50)
                });
            }
        };

        // --- 5. KIL√âP√âS ---
        window.logout = function() {
            localStorage.removeItem('mf_user');
            localStorage.removeItem('mf_pass');
            location.reload(); // Oldal friss√≠t√©se
        };
    </script>
</body>
</html>
